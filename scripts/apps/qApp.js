angular.module("RebateApp",[]),angular.module("RebateApp").constant("YIQIFA",{UID:"ishgo"}).constant("ALIMAMA",{PID:"mm_16076694_4176899_13692627",APPKEY:"",UNID:"ishgo"}),angular.module("RebateApp").directive("repayLink",[function(){return{link:function(a,b){a.redirect=function(){b[0].click()}}}}]),angular.module("RebateApp").factory("ReabateService",["$http","$location","YIQIFA",function(a,b,c){function d(c){a.get(b.$$protocol+"://"+b.$$host+"/assets/storage/rebates.json").success(function(a){angular.isFunction(c)&&c(a)})}return{rebate:function(a,b,e){if(angular.isFunction(e)){var f,g,h,i=/^(https|http):\/\/.+/;i.test(a)?(f=angular.parseUrl(a),d(function(d){if(g=d[f.rootDomain],!angular.isArray(g))return void e({rebate:!1});for(var j=0;(row=g[j])&&j<g.length;j++)if(f.domain===row.match){var k=angular.parseUrl(row.prefix);oQuery=angular.parseObject(k.query),sPrefix=row.prefix,"string"==typeof b.uid&&""!==b.uid&&(oQuery.e=b.uid||c.UID),sPrefix=sPrefix.replace(k.query,angular.parseString(oQuery)),h=i.test(row.redirect)?sPrefix+row.redirect:sPrefix+a,e({rebate:!0,url:h,prefix:sPrefix,actionId:row.actionId,from:row});break}})):e({rebate:!1})}}}}]),angular.module("RebateApp").controller("MainController",["$scope","$http","ALIMAMA","ReabateService",function(a,b,c,d){var e=this;a.rebate={mode:void 0,allow:void 0,redirect:void 0},a.user={},this.redirect=function(){"auto"===a.rebate.mode&&angular.isFunction(a.redirect)&&a.redirect()},a.alimama=function(b){var d=document.createElement("script"),e=document.getElementsByTagName("head")[0];window.alimamatk_show||(angular.isFunction(b)&&angular.element(d).on("load",b),d.charset="gbk",d.async=!0,d.src="http://a.alimama.cn/tkapi.js",e.insertBefore(d,e.firstChild)),window.alimamatk_onload=window.alimamatk_onload||[],window.alimamatk_onload.push({pid:c.PID,appkey:c.APPKEY,unid:a.user.uid||c.UNID})};var f=angular.parseUrl(window.location.href);if(f.query){var g=angular.parseObject(f.query);a.user.uid=g.u,a.rebate.mode=g.m,g.q&&(/(tmall|taobao)/.test(g.q)?(a.rebate.redirect=g.q,a.alimama(function(){setTimeout(e.redirect,300)})):d.rebate(g.q,a.user,function(b){b.rebate===!0?(a.rebate.allow=!0,a.rebate.redirect=b.url||b.from.redirect,setTimeout(e.redirect,300)):a.rebate.allow=!1}))}}]);