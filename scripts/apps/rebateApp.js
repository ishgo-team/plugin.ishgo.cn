angular.module("RebateApp",["Global"]),angular.module("RebateApp").directive("linkInput",[function(){return{link:function(a,b){b.on("keyup",function(a){if(13===a.keyCode){var c=b.val();/^(http|https):\/\//.test(c)&&window.open("repay.html?m=auto&q="+encodeURIComponent(c))}}),b.on("click",function(a){a.preventDefault(),b[0].select()})}}}]),angular.module("RebateApp").controller("MainController",["$scope",function(a){this.redirect=function(){"auto"===a.rebate.mode&&angular.isFunction(a.redirect)&&a.redirect()},this.alimama=function(b){var c=document.createElement("script"),d=document.getElementsByTagName("head")[0];window.alimamatk_show||(angular.isFunction(b)&&angular.element(c).on("load",b),c.charset="gbk",c.async=!0,c.src="http://a.alimama.cn/tkapi.js",d.insertBefore(c,d.firstChild)),window.alimamatk_onload=window.alimamatk_onload||[],window.alimamatk_onload.push({pid:ALIMAMA.PID,appkey:ALIMAMA.APPKEY,unid:a.user.uid||ALIMAMA.UNID})},a.repay=function(b){var c=angular.parseUrl(b);if(c.query){var d=angular.parseObject(c.query);a.user.uid=d.u,a.rebate.mode=d.m,d.q&&(/(tmall|taobao)/.test(d.q)?(a.rebate.redirect=d.q,self.alimama(function(){setTimeout(self.redirect,300)})):ReabateService.rebate(d.q,a.user,function(b){b.rebate===!0?(a.rebate.allow=!0,a.rebate.redirect=b.url||b.from.redirect,setTimeout(self.redirect,300)):a.rebate.allow=!1}))}},a.repay(window.location.href)}]);